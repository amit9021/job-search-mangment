# QA · Pre-Phase 0 User Isolation

| Scenario | Endpoint / Flow | Expected | Result |
| --- | --- | --- | --- |
| Claim legacy records | `AuthService.login` side-effect | First successful login assigns `userId` to all orphaned rows (Company/Job/Contact/Task/Grow tables). | ✅ Manual review via code + migration |
| Tenant enforced task update (owner) | `PATCH /tasks/:id` with owner token | 200 + updated payload. | ✅ Covered by `backend/test/user-isolation.e2e-spec.ts` |
| Tenant enforced task update (foreign) | `PATCH /tasks/:id` with different user token | 404 (record hidden). | ✅ `user-isolation.e2e-spec` |
| Tenant enforced task update (second user) | `PATCH /tasks/:id` with owning userB token | 200 + update isolated to userB. | ✅ `user-isolation.e2e-spec` |
| Prisma guardrails | Any `findMany`/`create`/`update` on Jobs/Contacts/Tasks/Grow | Automatic `{ userId }` injection + ownership checks. | ✅ Verified via Prisma middleware unit run (see implementation) |
| Context propagation | Non-public routes | `req.user.id` stored in `RequestContextService`; missing ID throws `UnauthorizedException`. | ✅ Covered by `JwtAuthGuard.handleRequest` |

## Test Commands
```bash
# Backend
cd backend
npm run test -- user-isolation.e2e-spec.ts
```

## Manual Verification Notes
- Confirmed new `docs/PLANS` + `docs/QA` artifacts are regenerated by `npm run refresh:context`.
- Spot-checked dashboard + contacts flows through the CLI using forged JWTs to ensure Prisma middleware scopes queries without controller changes.
